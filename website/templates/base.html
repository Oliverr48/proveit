<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}ProveIt{% endblock %}</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            indigo: {
              50: '#eef2ff',
              100: '#e0e7ff',
              400: '#818cf8',
              500: '#6366f1',
              600: '#4f46e5',
              700: '#4338ca'
            }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  {% block extra_css %}{% endblock %}
</head>
<body class="bg-slate-50">
  <!-- Hidden container to store flash messages for JavaScript to read -->
  <div id="flash-messages-data" style="display: none;" 
       data-flash-messages='{% if get_flashed_messages(with_categories=true) %}[{% for category, message in get_flashed_messages(with_categories=true) %}{"message": "{{ message|e }}", "category": "{{ category }}"}{% if not loop.last %},{% endif %}{% endfor %}]{% else %}[]{% endif %}'>
  </div>

  <div class="flex h-screen overflow-hidden">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-sm flex flex-col">
      <!-- Logo -->
      <div class="flex items-center px-6 py-5 border-b border-gray-100">
        <div class="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center">
          <span class="text-lg font-bold">P</span>
        </div>
        <span class="ml-3 text-lg font-bold text-gray-800">ProveIt</span>
      </div>
      
      <!-- Navigation -->
      <nav class="p-4 space-y-1 flex-1">
        <a href="/dashboard" class="nav-item flex items-center px-4 py-3 text-slate-700 {% if request.path == '/dashboard' %}active{% endif %}">
          <i class="fas fa-chart-pie mr-3 {% if request.path == '/dashboard' %}text-indigo-600{% else %}text-slate-500{% endif %}"></i>
          <span>Dashboard</span>
        </a>
        <a href="/projects" class="nav-item flex items-center px-4 py-3 text-slate-700 {% if request.path == '/projects' %}active{% endif %}">
          <i class="fas fa-folder mr-3 {% if request.path == '/projects' %}text-indigo-600{% else %}text-slate-500{% endif %}"></i>
          <span>Projects</span>
          <span class="ml-auto bg-indigo-100 text-indigo-800 text-xs px-2 py-0.5 rounded-full">{{projects|length}}</span>
        </a>
        <a href="/inbox" class="nav-item flex items-center px-4 py-3 text-slate-700 {% if request.path == '/team' %}active{% endif %}">
          <i class="fas fa-users mr-3 {% if request.path == '/team' %}text-indigo-600{% else %}text-slate-500{% endif %}"></i>
          <span>Invites</span>
        </a>
        <a href="/analytics" class="nav-item flex items-center px-4 py-3 text-slate-700 {% if request.path == '/analytics' %}active{% endif %}">
          <i class="fas fa-chart-bar mr-3 {% if request.path == '/analytics' %}text-indigo-600{% else %}text-slate-500{% endif %}"></i>
          <span>Analytics</span>
        </a>
      </nav>

      <!-- User Profile -->
      <div class="p-4 border-t border-gray-100">
        <div class="flex items-center">
          <div class="w-10 h-10 bg-indigo-100 text-indigo-700 rounded-full flex items-center justify-center font-medium">{{current_user.firstName[0]}}{{current_user.lastName[0]}}</div>
          <div class="ml-3">
            <p class="text-sm font-medium text-gray-800">{{current_user.firstName}} {{current_user.lastName}}</p>
            <p class="text-xs text-gray-500">Project Manager</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 overflow-auto">
      <!-- Header -->
      <div class="bg-white px-6 py-4 shadow-sm flex items-center justify-between">
        <div class="relative">
          <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm"></i>
          <input type="text" placeholder="Search..." 
                 class="search-input pl-10 pr-4 py-2 bg-slate-100 rounded-full text-sm w-64 focus:outline-none focus:ring focus:ring-indigo-200">
        </div>
        
        <div class="flex items-center space-x-6">
          <div class="w-10 h-10 bg-indigo-100 text-indigo-700 rounded-full flex items-center justify-center font-medium cursor-pointer hover:bg-indigo-200">
            {{current_user.firstName[0]}}{{current_user.lastName[0]}}
          </div>
        </div>
      </div>
      
      <!-- Page Content -->
      <main class="p-6">
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  <!-- Toast Notifications Container -->
  <div id="toast-container" class="fixed bottom-4 right-4 z-50 w-80"></div>

  <script src="{{ url_for('static', filename='js/script.js') }}"></script>
  {% block extra_js %}{% endblock %}

  <!-- Toast Notification System -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Get flash messages from the data attribute
      const flashMessagesContainer = document.getElementById('flash-messages-data');
      let flashMessages = [];
      
      if (flashMessagesContainer && flashMessagesContainer.dataset.flashMessages) {
        try {
          flashMessages = JSON.parse(flashMessagesContainer.dataset.flashMessages);
        } catch(e) {
          console.error('Error parsing flash messages:', e);
        }
      }
      
      // Display each flash message
      if (flashMessages && flashMessages.length > 0) {
        flashMessages.forEach(function(flash) {
          showToast(flash.message, flash.category);
        });
      }

      // Toast notification function
      function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        
        // Set icon and styling based on message type
        let icon = '';
        let bgColor = '';
        let borderColor = '';
        let textColor = '';
        
        if (type === 'success') {
          icon = '<div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></div>';
          bgColor = 'bg-white';
          borderColor = 'border-l-4 border-green-500';
          textColor = 'text-green-800';
        } else if (type === 'error' || type === 'danger') {
          icon = '<div class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></div>';
          bgColor = 'bg-white';
          borderColor = 'border-l-4 border-red-500';
          textColor = 'text-red-800';
        } else {
          icon = '<div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 text-indigo-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg></div>';
          bgColor = 'bg-white';
          borderColor = 'border-l-4 border-indigo-500';
          textColor = 'text-indigo-800';
        }
        
        // Create toast HTML
        toast.className = `${bgColor} ${borderColor} rounded-md shadow-lg p-4 mb-3 flex items-center transform transition-all duration-300 translate-y-8 opacity-0`;
        toast.innerHTML = `
          ${icon}
          <div class="ml-3 flex-grow">
            <div class="flex justify-between items-center">
              <p class="text-sm font-medium ${textColor}">${message}</p>
              <button class="text-gray-400 hover:text-gray-600 focus:outline-none">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
              </button>
            </div>
            <div class="w-full bg-gray-200 mt-2 rounded-full h-1 overflow-hidden opacity-75">
              <div class="toast-progress bg-current h-full w-full"></div>
            </div>
          </div>
        `;
        
        // Add to container
        container.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
          toast.classList.remove('translate-y-8', 'opacity-0');
        }, 10);
        
        // Setup progress bar animation
        const progressBar = toast.querySelector('.toast-progress');
        progressBar.style.transition = 'width 4s linear';
        
        // Start the countdown animation after a tiny delay
        setTimeout(() => {
          progressBar.style.width = '0%';
        }, 50);
        
        // Auto-dismiss after 4 seconds
        const dismissTimeout = setTimeout(() => {
          dismissToast(toast);
        }, 4000);
        
        // Setup dismissal with click
        toast.querySelector('button').addEventListener('click', () => {
          clearTimeout(dismissTimeout);
          dismissToast(toast);
        });
        
        // Pause progress bar on hover
        toast.addEventListener('mouseenter', () => {
          progressBar.style.transition = 'none';
          clearTimeout(dismissTimeout);
        });
        
        // Resume progress bar on mouse leave
        toast.addEventListener('mouseleave', () => {
          const remainingWidth = (progressBar.offsetWidth / progressBar.parentNode.offsetWidth) * 100;
          const remainingTime = (remainingWidth / 100) * 4000;
          
          if (remainingTime > 0) {
            progressBar.style.transition = `width ${remainingTime}ms linear`;
            progressBar.style.width = '0%';
            
            const newDismissTimeout = setTimeout(() => {
              dismissToast(toast);
            }, remainingTime);
            
            // Store timeout so it can be cleared if needed
            toast._dismissTimeout = newDismissTimeout;
          } else {
            dismissToast(toast);
          }
        });
      }
      
      // Function to dismiss a toast with animation
      function dismissToast(toast) {
        toast.classList.add('opacity-0', 'translate-y-8');
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }
      
      // Make function globally available
      window.showToast = showToast;
    });
  </script>
</body>
</html>